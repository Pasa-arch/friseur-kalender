<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Friseur Kalender</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
body { font-family: Arial, sans-serif; margin: 30px; }
input, select, button { padding: 6px; margin: 4px; }
table { border-collapse: collapse; width: 100%; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
.actions button { margin-right: 4px; }
</style>
</head>

<body>

<h1>Gemeinsamer Friseur-Kalender</h1>

<form id="eventForm">
  <select id="staff" required>
    <option value="">Mitarbeiter</option>
    <option>Soner</option>
    <option>G√ºlcin</option>
    <option>Kadir</option>
    <option>Herrmann</option>
  </select>

  <input id="customer" placeholder="Kunde">
  <input id="title" placeholder="Leistung" required>
  <input type="datetime-local" id="start" required>
  <input type="datetime-local" id="end" required>

  <button type="submit">Speichern</button>
</form>

<div style="margin:15px 0;">
  <button id="prevDay">‚óÄ</button>
  <strong id="dayLabel"></strong>
  <button id="nextDay">‚ñ∂</button>
</div>

<table>
<thead>
<tr>
  <th>Mitarbeiter</th>
  <th>Kunde</th>
  <th>Leistung</th>
  <th>Start</th>
  <th>Ende</th>
  <th>Aktion</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

<script>
/* ================= SUPABASE ================= */
const sb = supabase.createClient(
  "https://vsswsckjvfeglbtealdg.supabase.co",
  "DEIN_PUBLISHABLE_KEY_HIER"
);

/* ================= STATUS ================= */
let currentDay = new Date();
currentDay.setHours(0,0,0,0);
let editId = null;

const list = document.getElementById("list");
const dayLabel = document.getElementById("dayLabel");

/* ================= DATUM ================= */
function updateDayLabel(){
  dayLabel.textContent = currentDay.toLocaleDateString("de-DE", {
    weekday: "long", day: "2-digit", month: "2-digit", year: "numeric"
  });
}
updateDayLabel();

prevDay.onclick = () => {
  currentDay.setDate(currentDay.getDate() - 1);
  updateDayLabel();
  loadEvents();
};

nextDay.onclick = () => {
  currentDay.setDate(currentDay.getDate() + 1);
  updateDayLabel();
  loadEvents();
};

/* ================= LADEN ================= */
async function loadEvents(){
  const startDay = new Date(currentDay);
  startDay.setHours(0,0,0,0);

  const endDay = new Date(currentDay);
  endDay.setHours(23,59,59,999);

  const { data, error } = await sb
    .from("events")
    .select("*")
    .gte("start_time", startDay.toISOString())
    .lte("start_time", endDay.toISOString())
    .order("start_time");

  if (error) {
    alert(error.message);
    return;
  }

  renderTable(data || []);
}

/* ================= TABELLE ================= */
function renderTable(events){
  list.innerHTML = "";

  events.forEach(e => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${e.staff}</td>
      <td>${e.customer || "-"}</td>
      <td>${e.title}</td>
      <td>${new Date(e.start_time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</td>
      <td>${new Date(e.end_time).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</td>
      <td class="actions">
        <button onclick="editEvent('${e.id}')">‚úèÔ∏è</button>
        <button onclick="deleteEvent('${e.id}')">üóë</button>
      </td>
    `;
    list.appendChild(tr);
  });
}

/* ================= FORM ================= */
eventForm.onsubmit = async (e) => {
  e.preventDefault();

  const startTime = new Date(currentDay);
  const endTime = new Date(currentDay);

  const [sh, sm] = start.value.split(":");
  const [eh, em] = end.value.split(":");

  startTime.setHours(sh, sm, 0, 0);
  endTime.setHours(eh, em, 0, 0);

  const ev = {
    staff: staff.value,
    customer: customer.value,
    title: title.value,
    start_time: startTime.toISOString(),
    end_time: endTime.toISOString()
  };

  editId
    ? await sb.from("events").update(ev).eq("id", editId)
    : await sb.from("events").insert([ev]);

  editId = null;
  eventForm.reset();
  loadEvents();
};


/* ================= EDIT ================= */
window.editEvent = async id => {
  const { data } = await sb.from("events").select("*").eq("id", id).single();

  staff.value = data.staff;
  customer.value = data.customer || "";
  title.value = data.title;
  start.value = data.start_time.slice(0,16);
  end.value = data.end_time.slice(0,16);

  editId = id;
};

/* ================= DELETE ================= */
window.deleteEvent = async id => {
  if (!confirm("Termin wirklich l√∂schen?")) return;

  const { error } = await sb.from("events").delete().eq("id", id);
  if (error) {
    alert(error.message);
    return;
  }

  loadEvents();
};

/* START */
loadEvents();
</script>

</body>
</html>

